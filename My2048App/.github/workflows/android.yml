
name: Android CI



on:

  push:

    branches: [ main, master ]

  pull_request:



jobs:

  build:

    name: Build (assembleDebug)

    runs-on: ubuntu-latest

    env:

      ANDROID_SDK_ROOT: ${{ runner.temp }}/android-sdk



    steps:

      - name: Checkout

        uses: actions/checkout@v4



      - name: Set up JDK 11

        uses: actions/setup-java@v4

        with:

          distribution: 'temurin'

          java-version: '11'



      - name: Install Android SDK (command-line tools) and build-tools/platforms

        uses: android-actions/setup-android@v2

        with:

          api-level: 33

          build-tools: 33.0.2

          # components can include "platform-tools" automatically



      - name: Accept SDK licenses

        run: yes | ${ANDROID_SDK_ROOT}/cmdline-tools/latest/bin/sdkmanager --licenses



      - name: Cache Gradle

        uses: actions/cache@v4

        with:

          path: |

            ~/.gradle/caches

            ~/.gradle/wrapper

          key: gradle-cache-${{ runner.os }}-v1-${{ hashFiles('**/*.gradle*','**/gradle-wrapper.properties') }}

          restore-keys: |

            gradle-cache-${{ runner.os }}-v1-



      - name: Make gradlew executable (if present)

        if: always()

        run: |

          if [ -f "./gradlew" ]; then chmod +x ./gradlew; fi



      - name: Build (assembleDebug) using Gradle Wrapper

        run: |

          if [ -f "./gradlew" ]; then

            ./gradlew -Pandroid.testInstrumentationRunnerArguments.disableAnalytics=true assembleDebug --no-daemon

          else

            echo "Gradle wrapper not found. You must include gradle wrapper files in repository: gradlew, gradlew.bat, gradle/wrapper/*"

            echo "Alternatively, generate wrapper locally with: gradle wrapper --gradle-version 7.5.1"

            exit 1

          fi

